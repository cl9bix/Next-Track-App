<!-- templates/create_event.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Next Track ‚Äî Create Event</title>
  <meta name="description" content="Create an event for your club." />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="Cache-Control" content="no-store" />

  <style>
    :root{
      --bg:#0b0720; --bg2:#09061f;
      --txt:#f0eff6; --muted:#b8b6d3;
      --accent1:#4dd0ff; --accent2:#ff4dd2; --ok:#77f2a1; --warn:#ffcc66; --bad:#ff6b8a;
      --glass:rgba(255,255,255,.06); --border:rgba(255,255,255,.12);
      --shadow:0 10px 40px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.05);
      --radius:16px; --maxw:980px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; color:var(--txt); background:var(--bg); font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif; -webkit-font-smoothing:antialiased}
    a{color:inherit; text-decoration:none}
    .container{width:100%; max-width:var(--maxw); margin:0 auto; padding:0 16px}

    .bg{position:fixed; inset:0; z-index:-2; background:
      radial-gradient(55vw 55vw at 15% 10%, rgba(77,208,255,.25), transparent 60%),
      radial-gradient(45vw 45vw at 90% 0%, rgba(255,77,210,.20), transparent 60%),
      radial-gradient(35vw 35vw at 70% 80%, rgba(105,92,255,.18), transparent 60%),
      linear-gradient(180deg, #0b0720 0%, #08051a 100%);}
    .blob{position:fixed; width:48vmin; height:48vmin; border-radius:50%; filter:blur(18px); mix-blend-mode:screen; opacity:.45; z-index:-1; animation:drift 26s ease-in-out infinite}
    .blob.b2{right:-8vmin; top:8vmin; background:radial-gradient(circle at 70% 40%, rgba(255,77,210,.25), rgba(77,208,255,.12)); animation-duration:30s}
    .blob.b1{left:-6vmin; top:20vmin; background:radial-gradient(circle at 30% 30%, rgba(77,208,255,.25), rgba(255,77,210,.15))}
    @keyframes drift{0%{transform:translate(-5vmin,0)}50%{transform:translate(6vmin,2vmin)}100%{transform:translate(-5vmin,0)}}

    header{position:sticky; top:0; background:linear-gradient(180deg, rgba(8,5,26,.7), rgba(8,5,26,.25));
      backdrop-filter:blur(8px) saturate(140%); border-bottom:1px solid var(--border); z-index:5}
    .topbar{display:flex; align-items:center; justify-content:space-between; gap:10px; padding:12px 0}
    .brand{display:flex; align-items:center; gap:10px}
    .brand img{width:32px; height:32px; border-radius:8px}
    .brand b{letter-spacing:.2px}
    .pill{display:flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px;
      background:var(--glass); border:1px solid var(--border); box-shadow:var(--shadow); font-weight:800}

    .wrap{padding:16px 0 44px}
    .card{background:var(--glass); border:1px solid var(--border); border-radius:16px; box-shadow:var(--shadow)}
    .panel{padding:16px}
    .h{display:flex; align-items:flex-start; justify-content:space-between; gap:12px; margin-bottom:10px}
    .ttl{font-weight:950; font-size:18px}
    .sub{color:var(--muted); font-size:13px}

    .form{display:grid; gap:12px; margin-top:12px}
    label{display:grid; gap:6px; font-size:12px; color:var(--muted)}
    .input, .textarea{
      width:100%;
      background:rgba(255,255,255,.06);
      border:1px solid var(--border);
      border-radius:12px;
      padding:12px 14px;
      color:var(--txt);
      outline:none;
    }
    .textarea{min-height:86px; resize:vertical}
    .input:focus, .textarea:focus{border-color:rgba(255,255,255,.28); box-shadow:0 0 0 3px rgba(77,208,255,.10)}

    .grid2{display:grid; gap:10px}
    @media (min-width:720px){ .grid2{grid-template-columns:1fr 1fr} }

    .btn{
      border:none; padding:12px 14px; border-radius:12px; font-weight:950; cursor:pointer;
      background:linear-gradient(135deg, rgba(77,208,255,.18), rgba(255,77,210,.18));
      border:1px solid rgba(255,255,255,.22);
      color:var(--txt);
      display:inline-flex; align-items:center; gap:8px;
    }
    .btn.primary{background:linear-gradient(135deg, rgba(77,208,255,.30), rgba(255,77,210,.30)); border-color:rgba(255,255,255,.28)}
    .btn.ghost{background:transparent}
    .btn:active{transform:translateY(1px)}
    .row{display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap}

    .err{
      margin-top:10px;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(255,107,138,.35);
      background:rgba(255,107,138,.08);
      color:#ffd5de;
      font-weight:900;
      font-size:13px;
      {% if not error %}display:none;{% endif %}
    }

    .djbox{padding:12px}
    .djhead{display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:10px}
    .djlist{display:grid; gap:10px}
    @media (min-width:720px){ .djlist{grid-template-columns:1fr 1fr} }
    .dj{
      display:flex; align-items:center; gap:10px;
      padding:12px; border-radius:14px;
      background:rgba(255,255,255,.06); border:1px solid var(--border);
      cursor:pointer;
      user-select:none;
    }
    .dj input{width:18px; height:18px}
    .dj .name{font-weight:900}
    .dj .meta{color:var(--muted); font-size:12px; margin-top:2px}
    .hint{color:var(--muted); font-size:12px; line-height:1.35}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}

    .kbd{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
      background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.12); padding:2px 6px; border-radius:8px; color:var(--txt)}
  </style>
</head>

<body>
<div class="bg"></div>
<div class="blob b1"></div><div class="blob b2"></div>

<header>
  <div class="container topbar">
    <div class="brand">
      <img src="/static/logo.jpg" alt="Next Track" />
      <div>
        <b>Next Track</b>
        <div class="sub">Admin ¬∑ Create event</div>
      </div>
    </div>
    <div class="pill">üë§ {{ admin.username if admin and admin.username else "Admin" }}</div>
  </div>
</header>

<main class="container wrap">
  <section class="card panel">
    <div class="h">
      <div>
        <div class="ttl">Create new event</div>
        <div class="sub">Fill details and attach DJs. Dates: <span class="mono">YYYY-MM-DD HH:MM</span> or ISO.</div>
      </div>
      <div class="hint">Tip: paste fast with <span class="kbd">Ctrl</span>+<span class="kbd">V</span></div>
    </div>

    <div id="errBox" class="err">{% if error %}{{ error }}{% endif %}</div>

    <form id="form" class="form" method="post" action="/admin/events/new">
      <label>
        Title
        <input class="input" name="title" required placeholder="Friday Night / Tech House" />
      </label>

      <label>
        Preview (optional)
        <textarea class="textarea" name="preview" placeholder="Short description for the event page / mini app."></textarea>
      </label>

      <div class="grid2">
        <label>
          Start date (optional)
          <input class="input" name="start_date" placeholder="2026-01-29 22:00" />
        </label>

        <label>
          End date (optional)
          <input class="input" name="end_date" placeholder="2026-01-30 04:00" />
        </label>
      </div>

      <section class="card djbox">
        <div class="djhead">
          <div>
            <div class="ttl" style="font-size:15px">DJs</div>
            <div class="sub">Select one or more. We‚Äôll save IDs as CSV into <span class="mono">dj_ids</span>.</div>
          </div>
          <div class="hint mono" id="selCount">0 selected</div>
        </div>

        <div class="djlist" id="djList">
          {% if djs and djs|length %}
            {% for dj in djs %}
              <label class="dj">
                <input type="checkbox" class="dj-cb" value="{{ dj.id }}" />
                <div>
                  <div class="name">{{ dj.name }}</div>
                  <div class="meta">ID: <span class="mono">{{ dj.id }}</span></div>
                </div>
              </label>
            {% endfor %}
          {% else %}
            <div class="hint">No DJs in database yet. You can still create event and attach DJs later.</div>
          {% endif %}
        </div>

        <input type="hidden" name="dj_ids" id="djIds" value="" />
      </section>

      <div class="row">
        <button class="btn primary" type="submit">‚úÖ Create</button>
        <a class="btn ghost" href="/admin/">‚Üê Back to dashboard</a>
      </div>

      <div class="hint">
        Notes:
        <ul>
          <li>If you leave dates empty ‚Äî event will be treated as ‚Äúscheduled‚Äù on dashboard (until you set start/end).</li>
          <li>Date examples: <span class="mono">2026-01-29 22:00</span> or <span class="mono">2026-01-29T22:00</span></li>
          <li>If timezones matter ‚Äî store everything in UTC on backend (you already do that üëå).</li>
        </ul>
      </div>
    </form>
  </section>
</main>

<script>
  const form = document.getElementById('form');
  const djIds = document.getElementById('djIds');
  const selCount = document.getElementById('selCount');
  const errBox = document.getElementById('errBox');

  function updateDjIds(){
    const cbs = Array.from(document.querySelectorAll('.dj-cb'));
    const ids = cbs.filter(x => x.checked).map(x => x.value);
    djIds.value = ids.join(',');
    selCount.textContent = `${ids.length} selected`;
  }

  document.querySelectorAll('.dj-cb').forEach(cb=>{
    cb.addEventListener('change', updateDjIds);
  });

  updateDjIds();

  form.addEventListener('submit', (e)=>{
    // make sure hidden is up to date
    updateDjIds();

    // lightweight date sanity check (optional)
    const sd = form.querySelector('[name="start_date"]').value.trim();
    const ed = form.querySelector('[name="end_date"]').value.trim();
    if (sd && ed && sd.length >= 10 && ed.length >= 10) {
      // do not parse hard; backend is source of truth
      // just prevent obvious case: same string but reversed spaces etc is allowed
    }

    // hide old error (if any)
    if (errBox) errBox.style.display = 'none';
  });
</script>
</body>
</html>
